// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../.prisma/client/default"
}

datasource db {
  provider = "sqlite"
}

// 训练条目
model TrainingItem {
  id        String     @id @default(cuid())
  title     String     // 标题
  audioUrl  String     // 音频文件路径（相对于public目录）
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  sentences Sentence[] // 关联的句子
}

// 句子分段
model Sentence {
  id            String     @id @default(cuid())
  trainingItemId String
  trainingItem  TrainingItem @relation(fields: [trainingItemId], references: [id], onDelete: Cascade)
  text          String     // 英语句子文本
  translation   String?    // 中文翻译
  startTime     Float      // 开始时间（秒）
  endTime       Float      // 结束时间（秒）
  order         Int        // 顺序
  userNotes     UserNote[] // 用户笔记
}

// 用户笔记（生词和注释）
model UserNote {
  id         String   @id @default(cuid())
  sentenceId String
  sentence   Sentence @relation(fields: [sentenceId], references: [id], onDelete: Cascade)
  words      String   @default("") // 生词（JSON格式存储）
  notes      String   @default("") // 注释（JSON格式存储）
  userId     String   @default("default") // 用户ID（可以后续扩展为多用户）
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([sentenceId, userId])
  @@index([sentenceId])
  @@index([userId])
}
