const fs = require('fs');
const path = require('path');

const defaultJsPath = path.join(__dirname, '..', 'node_modules', '@prisma', 'client', 'default.js');
const prismaClientPath = path.join(__dirname, '..', '.prisma', 'client', 'default', 'client.ts');

// Create index.js in .prisma/client/default if it doesn't exist
const indexJsPath = path.join(__dirname, '..', '.prisma', 'client', 'default', 'index.js');
if (fs.existsSync(prismaClientPath) && !fs.existsSync(indexJsPath)) {
  // Try to use the generated client directly via dynamic import in Next.js
  // For now, we'll create a wrapper that Next.js can handle
  const indexContent = `// This file is auto-generated by fix-prisma-path.js
// Prisma Client is generated as TypeScript and will be handled by Next.js/Turbopack
export * from './client';
`;
  fs.writeFileSync(indexJsPath, indexContent);
}

if (fs.existsSync(defaultJsPath)) {
  // Use a path that Next.js/Turbopack can resolve
  const content = `const path = require('path');
// Point to the directory, Next.js will handle TypeScript compilation
const prismaClientPath = path.resolve(__dirname, '../../..', '.prisma/client/default');
try {
  module.exports = require(prismaClientPath);
} catch (e) {
  // Fallback: try to require the client directly if path resolution fails
  console.warn('Prisma client path resolution warning:', e.message);
  // This will be handled by Next.js module resolution
  throw e;
}
`;
  fs.writeFileSync(defaultJsPath, content);
  console.log('✅ Fixed @prisma/client/default.js path');
} else {
  console.log('⚠️  @prisma/client/default.js not found, skipping fix');
}
